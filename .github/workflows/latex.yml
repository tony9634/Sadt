name: CI LaTeX + Spellcheck

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Installazione Java per LanguageTool
      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '17'

      # 3️⃣ Installazione strumenti LaTeX
      - name: Install TeX Live
        run: sudo apt-get update && sudo apt-get install -y texlive-full latexmk biber

      # 4️⃣ Download LanguageTool
      - name: Download LanguageTool
        run: |
          wget https://languagetool.org/download/LanguageTool-stable.zip
          unzip LanguageTool-stable.zip

      # 5️⃣ Controllo ortografico e grammaticale (Italiano) su tutti i file .tex
      - name: LanguageTool Spell & Grammar Check
        run: |
          echo "Eseguo controllo ortografico/grammaticale su tutti i file .tex"
          java -jar LanguageTool-*/languagetool-commandline.jar -l it -c UTF-8 -r . | tee lt.log
          if grep -q "ERROR" lt.log; then
            echo "::error ::Trovati errori ortografici/grammaticali"
            exit 1
          fi

      # 6️⃣ Compilazione PDF
      - name: Compile PDF
        run: |
          latexmk -pdf -interaction=nonstopmode -halt-on-error main.tex

      # 7️⃣ Caricamento PDF come artefatto
      - name: Upload PDF Artifact
        uses: actions/upload-artifact@v4
        with:
          name: compiled-pdf
          path: main.pdf
