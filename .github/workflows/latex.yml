name: Build & Release PDF 

 

on: 

  push: 

    branches: [ main ] 

  workflow_dispatch: 

 

jobs: 

  build: 

    runs-on: ubuntu-latest 

    outputs: 

      pdf_path: ${{ steps.upload_pdf.outputs.artifact_path }} 

 

    steps: 

      - name: Checkout repository 

        uses: actions/checkout@v4 

 

      - name: Install TeXLive Full 

        run: | 

          sudo apt-get update 

          sudo apt-get install -y texlive-full ghostscript 

 

      - name: Compile main.tex 

        run: | 

          latexmk -pdf -interaction=nonstopmode -shell-escape main.tex 

 

      - name: Upload PDF as artifact 

        id: upload_pdf 

        uses: actions/upload-artifact@v4 

        with: 

          name: Sadt-PDF 

          path: main.pdf 

 

  release: 

    needs: build 

    runs-on: ubuntu-latest 

 

    steps: 

      - name: Download compiled PDF 

        uses: actions/download-artifact@v4 

        with: 

          name: Sadt-PDF 

          path: ./pdf 

 

      - name: Create Release Tag 

        id: tag 

        run: | 

          # Trova ultimo tag, altrimenti parte da v0 

          LATEST=$(git tag --list "v*" | sort -V | tail -n 1) 

          if [ -z "$LATEST" ]; then 

            NEXT=v1 

          else 

            NUM=${LATEST#v} 

            NEXT=v$((NUM + 1)) 

          fi 

          echo "next_tag=$NEXT" >> $GITHUB_OUTPUT 

 

      - name: Create GitHub Release 

        uses: softprops/action-gh-release@v1 

        with: 

          tag_name: ${{ steps.tag.outputs.next_tag }} 

          name: "Release ${{ steps.tag.outputs.next_tag }}" 

          draft: false 

          prerelease: false 

          files: ./pdf/main.pdf 

        env: 

          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
